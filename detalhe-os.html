<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da OS - Agoora Hub</title>

    <!-- Bibliotecas de PDF removidas em favor do CSS Print Nativo -->

    <!-- CSS Global -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="header-title">
            <img src="https://static.wixstatic.com/media/8e154d_4a12ed9159714e48b78edd19819bb5a0~mv2.png/v1/fill/w_40,h_40,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Logo_Redondo.png"
                alt="Logo Agoora Hub">
            <h1>Gerenciador - Agoora Hub</h1>
        </div>
        <nav>
            <a href="os.html" id="nav-os-btn" class="active">Painel de OS</a>
            <a href="ativo.html" id="nav-ativos-btn">Painel de Ativos</a>
            <a href="crm.html" id="nav-crm-btn">CRM</a>
            <!-- LINHA ADICIONADA ABAIXO -->
            <a href="#" id="logout-btn" class="logout-btn">Sair</a>
        </nav>
    </header>

    <main>
        <!-- TELA 2: DETALHES DA OS -->
        <div id="details-view">
            <div class="details-header">
                <button id="back-to-dashboard-btn">&leftarrow; Voltar ao Painel de OS</button>
                <h2 id="os-details-title">Carregando...</h2>
                <button id="edit-os-details-btn">Editar OS</button>
            </div>

            <!-- INÍCIO: Card de Informações do CRM -->
            <div id="crm-details-panel" class="card is-hidden">
                <h3>Informações do Cliente</h3>
                <div id="crm-info-container" class="detail-grid"></div>
            </div>
            <!-- FIM: Card de Informações do CRM -->

            <div class="card">
                <h3>Adicionar Novo Ativo</h3>
                <div id="add-ativo-form">
                    <input type="text" id="ativo-search-input" placeholder="Buscar Ativo por nome..."
                        autocomplete="off">
                    <div id="ativo-suggestions"></div>

                    <div class="billing-type-selector">
                        <strong>Faturar por:</strong>
                        <label><input type="radio" name="billing-type" value="hora" checked> Hora</label>
                        <label><input type="radio" name="billing-type" value="diaria"> Diária</label>
                    </div>

                    <div id="date-inputs-hora" class="date-time-inputs">
                        <label>Início: <input type="datetime-local" id="start-time-input"></label>
                        <label>Fim: <input type="datetime-local" id="end-time-input"></label>
                    </div>

                    <div id="date-inputs-diaria" class="date-time-inputs is-hidden">
                        <label>Data de Início: <input type="date" id="start-date-input"></label>
                        <label>Data de Fim: <input type="date" id="end-date-input"></label>
                    </div>

                    <button id="add-ativo-btn">Adicionar Ativo à OS</button>
                    <p id="error-message" class="error-message"></p>
                </div>
            </div>

            <h3>Ativos Alocados</h3>
            <div id="alocados-list" class="card">
                <p>Carregando ativos...</p>
            </div>

            <!-- INÍCIO: Resumo Financeiro -->
            <div id="financial-summary-panel" class="card">
                <h3>Resumo Financeiro</h3>
                <div id="financial-details-grid">
                    <div class="financial-item">
                        <strong>Valor Bruto</strong>
                        <span id="os-gross-value">R$ 0,00</span>
                    </div>
                    <div class="financial-item">
                        <strong>Valor de Desconto</strong>
                        <span id="os-discount-value">R$ 0,00</span>
                    </div>
                    <div class="financial-item">
                        <strong>Valor Total da OS</strong>
                        <span id="os-final-total-value">R$ 0,00</span>
                    </div>
                </div>
            </div>
            <!-- FIM: Resumo Financeiro -->

            <div class="actions-footer">
                <p id="save-status"></p>
                <button id="generate-pdf-btn" style="background-color: var(--secondary-color);">Gerar PDF</button>
                <button id="save-os-btn" disabled>Salvar Históricos no Notion</button>
            </div>
        </div>
    </main>

    <!-- MODAL PARA CRIAR/EDITAR OS (Usado para editar) -->
    <div id="os-modal" class="modal-overlay is-hidden">
        <div class="modal-content">
            <button id="os-modal-close-btn" class="modal-close-btn">&times;</button>
            <h3 id="os-modal-title"></h3>
            <div class="modal-body">
                <div class="form-group">
                    <label for="os-name-input">Nome da Ordem de Serviço:</label>
                    <input type="text" id="os-name-input" placeholder="Ex: OS-28 - Evento Corporativo">
                </div>
                <div class="form-group">
                    <label for="os-modal-discount-input">Valor de Desconto:</label>
                    <input type="text" id="os-modal-discount-input" placeholder="R$ 0,00">
                </div>
                <p id="os-modal-error" class="error-message"></p>
            </div>
            <div class="modal-footer">
                <button id="os-modal-cancel-btn" class="modal-cancel-btn">Cancelar</button>
                <button id="os-modal-save-btn">Salvar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PARA EDITAR HISTÓRICO -->
    <div id="historico-edit-modal" class="modal-overlay is-hidden">
        <div class="modal-content">
            <button id="historico-modal-close-btn" class="modal-close-btn">&times;</button>
            <h3 id="historico-modal-title">Editar Alocação</h3>
            <div class="modal-body">
                <p><strong>Ativo:</strong> <span id="historico-modal-ativo-name"></span></p>
                <div class="billing-type-selector">
                    <strong>Faturar por:</strong>
                    <label><input type="radio" name="edit-billing-type" value="hora"> Hora</label>
                    <label><input type="radio" name="edit-billing-type" value="diaria"> Diária</label>
                </div>
                <div id="edit-date-inputs-hora" class="date-time-inputs">
                    <label>Início: <input type="datetime-local" id="edit-start-time-input"></label>
                    <label>Fim: <input type="datetime-local" id="edit-end-time-input"></label>
                </div>
                <div id="edit-date-inputs-diaria" class="date-time-inputs is-hidden">
                    <label>Data de Início: <input type="date" id="edit-start-date-input"></label>
                    <label>Data de Fim: <input type="date" id="edit-end-date-input"></label>
                </div>
                <p id="historico-modal-error" class="error-message"></p>
            </div>
            <div class="modal-footer">
                <button id="historico-modal-cancel-btn" class="modal-cancel-btn">Cancelar</button>
                <button id="historico-modal-save-btn">Salvar Alteração</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE PRÉ-IMPRESSÃO (Novo) -->
    <div id="print-modal" class="modal-overlay is-hidden"
        style="align-items: flex-start; padding-top: 50px; overflow-y: auto;">
        <div class="modal-content"
            style="max-width: 1000px; width: 95%; display: flex; flex-direction: column; gap: 20px; height: 85vh;">

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">Configurar Impressão</h3>
                <button id="print-modal-close-btn" class="modal-close-btn" style="position: static;">&times;</button>
            </div>

            <div style="display: flex; gap: 30px; flex: 1; overflow: hidden;">
                <!-- Coluna da Esquerda: Opções -->
                <div
                    style="width: 300px; min-width: 250px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; padding-right: 10px;">
                    <div class="card" style="margin: 0; padding: 1.5rem;">
                        <h4 style="margin-top: 0; font-size: 1rem; margin-bottom: 1rem;">Personalizar</h4>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="print-check-company" checked>
                                <span>Dados da Empresa</span>
                            </label>

                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="print-check-client" checked>
                                <span>Dados do Cliente</span>
                            </label>

                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="print-check-values" checked>
                                <span>Valores Financeiros</span>
                            </label>

                            <hr style="width: 100%; border: 0; border-top: 1px solid #eee; margin: 10px 0;">

                            <button id="do-print-btn"
                                style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path
                                        d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" />
                                    <path d="M6 14h12v8H6z" />
                                </svg>
                                Imprimir / Salvar PDF
                            </button>
                        </div>
                    </div>

                    <div
                        style="background-color: #f0f4f8; padding: 15px; border-radius: 8px; font-size: 0.85rem; color: #555; line-height: 1.5;">
                        <strong>Dica:</strong> Na janela de impressão que abrirá:
                        <ul style="padding-left: 20px; margin: 5px 0;">
                            <li>Escolha "Salvar como PDF"</li>
                            <li>Defina "Margens" como "Nenhuma" ou "Mínima" para melhor resultado</li>
                        </ul>
                    </div>
                </div>

                <!-- Coluna da Direita: Preview (Paper View) -->
                <div
                    style="flex: 1; background-color: #525659; padding: 30px; border-radius: 8px; overflow-y: auto; display: flex; justify-content: center;">

                    <!-- A Folha A4 simulada -->
                    <div id="print-preview-area" class="document-previewA4">
                        <!-- O conteúdo será injetado aqui via JS -->
                    </div>

                </div>
            </div>
        </div>
    </div>


    <footer>
        <p id="system-version">v3.0.0 (MPA)</p>
    </footer>

    <!-- Scripts -->
    <script src="common.js"></script>
    <script src="detalhe-os.js"></script>
</body>

</html>